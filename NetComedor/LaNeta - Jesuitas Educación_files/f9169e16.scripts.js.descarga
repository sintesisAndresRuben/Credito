"use strict";angular.module("authentication",["config","ngCookies"]),angular.module("ui",[]);var underscore=angular.module("underscore",[]);underscore.factory("_",function(){return window._}),angular.module("lanetApp",["authentication","ui","underscore","angularSlideables","ngResource","ngSanitize","ngRoute","LocalStorageModule"]).config(["$routeProvider","$locationProvider","$httpProvider","localStorageServiceProvider",function(a,b,c,d){c.interceptors.push("authInterceptor"),a.when("/lanet",{controller:"ServiceList",templateUrl:"views/services.html"}),d.setPrefix("lanetApp")}]).run(["_","AuthGateway","$rootScope","Sidebar","FavoritesSidebar","Detail","Modal","Logger","Alert","Tutorial",function(a,b,c,d,e,f,g,h,i,j){c.sidebar=d,c.favorites_sidebar=e,c.detail=f,c.lightbox=g,c.logger=h,c.alert=i,c.tutorial=j,c.hasImage=function(b){var c=["admin","directori","group_admin","icon-logout","infermeria","mail","r2m","webteca","ampa","docs","esecretaria","jira","moodle","rebuts","arxius","drive","family","icon-close_white","icon-search","llista","notes","boy","ebook_lib","forum","icon-content","icon_close","logo_fje","password","stats","calendari","ebooks","gestor","picasa","treballs","catalegs","edit","girl","picassa","tutorship","cicles","group","infantil","qualiteasy","web"];return a.contains(c,b)},FastClick.attach(document.body),b.redirectToEntryPoint()}]),angular.module("lanetApp").service("API",["$q","$http","Storage","BASE_API_URL",function(a,b,c,d){var e=function(e){var f=d+"/"+e+"?callback=JSON_CALLBACK",g=c.get(e),h=a.defer();return g?(h.resolve(g),h.promise):b.jsonp(f).then(function(a){return c.set(e,a),a})},f=function(a,c,d){return b.post(a+"/"+c,d)};return{getUserInfo:function(){return e("user_info")},getInformation:function(){return e("information")},getNotifications:function(a){return e("information/"+a.ID)},getModal:function(){return e("modal")},getFavorites:function(){return e("favorites")},get:function(a,b){var c="";return a&&(c+="groups/"+a.ID+"/"),c+="services/"+b.id,e(c)},endpoint:function(a){return e(a)},postFavorite:function(a){return c.delete("favorites"),f(d,"favorite",a)},postLog:function(a){return f("http://esic.fje.edu","informacions/Registre/default.ashx",a)}}}]),angular.module("lanetApp").service("Storage",["_","localStorageService","$cookies","LOCALSTORAGE_EXPIRATIONS","LOCALSTORAGE_DEFAULT_EXPIRATION",function(a,b,c,d,e){var f=function(a){for(var b=0;b<d.length;b++){var c=d[b];if(0===a.indexOf(c.key))return c.expiration}return e},g=function(a){var c=h(a),d=new Date,e=new Date(b.get(c)),g=(d-e)/1e3;return g<=f(a)},h=function(a){return i(a)+".dateFromLocalStorage"},i=function(a){return c.gs2php+"."+a};return{get:function(a){var c=i(a),d=g(a);return d?b.get(c):void 0},set:function(a,c){var d=i(a),e=h(a),f=new Date;b.set(e,f),b.set(d,c)},"delete":function(a){var c=i(a),d=h(a);b.remove(c,d)},reset:function(){b.clearAll()}}}]),angular.module("lanetApp").filter("weekday",function(){var a=["Diumenge","Dilluns","Dimarts","Dimecres","Dijous","Divendres","Dissabte"];return function(b){return a[b]}}).filter("day_and_month",function(){var a=["Gener","Febrer","Març","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"];return function(b){var c=b.split(" ")[0].split("/");return c[0]+" de "+a[parseInt(c[1])-1]}}),angular.module("authentication").factory("authInterceptor",["$cookies",function(a){return{request:function(b){return b.headers=b.headers||{},a.gs2php&&(b.headers.Authorization="Bearer "+a.gs2php),b},response:function(a){return a}}}]).factory("AuthGateway",["$cookies","$cookieStore","ENV","$window","$location","Storage",function(a,b,c,d,e,f){var g=a.gs2php,h=a.resetstorage,i=function(){return void 0!==g},j=function(){return void 0!==h};return{redirectToEntryPoint:function(){"development"===c||i()?(j()&&(b.remove("resetstorage"),f.reset()),e.path("/lanet")):d.location.replace("http://srv.fje.cat/login")}}}]),angular.module("ui").service("FavoritesSidebar",["Favorites","Alert",function(a,b){return{active:!1,isActive:function(){return this.active},toggle:function(){this.active=!this.active},toggleFavorite:function(c,d){d.stopPropagation(),a.hasMaxFavorites()&&!c.isFavorite?b.open():a.toggleFavorite(c)},hasItems:function(){return a.hasFavorites()},maxItems:function(){return a.maxFavorites()}}}]).service("Sidebar",function(){return{opened:!0,isOpen:function(){return this.opened},toggle:function(){this.opened=!this.opened},close:function(){this.opened&&(this.opened=!1)}}}).service("Detail",["$timeout",function(a){return{hasDetail:!1,hasDetailLVL2:!1,hadDetailLVL2:!1,showDetail:function(){this.hasDetail=!0},hideDetail:function(){this.hasDetail=!1;var b=this;a(function(){b.hideLVL2(b),b.hadDetailLVL2=!1},500)},showLVL2:function(){this.hasDetailLVL2=!0},hideLVL2:function(a){a||(a=this),a.hadDetailLVL2=!0,a.hasDetailLVL2=!1}}}]).service("Modal",function(){return{hasLightbox:!1,showLightbox:function(){this.hasLightbox=!0},hideLightbox:function(){this.hasLightbox=!1}}}).service("Alert",function(){return{opened:!1,title:"Ooops!",message:"Has arribat al <strong>màxim de favorits</strong> a afegir.<br><br> Elimina els elements que ja no són tan importants i tindràs <strong>espai disponible per afegir-ne de nous</strong>.",button:"D'acord",open:function(){this.opened=!0},close:function(){this.opened=!1}}}).service("Tutorial",["$cookies","$window",function(a,b){return{opened:!1,notShowAgain:!1,open:function(){this.opened=!0},close:function(){this.opened=!1},alreadySeen:function(){return void 0!==a.tutorialseen},isDesktop:function(){return b.innerWidth>580}}}]),angular.module("lanetApp").directive("userInfo",function(){return{restrict:"E",templateUrl:"views/user_info.html"}}).directive("groupNotifications",function(){return{restrict:"E",templateUrl:"views/group_notifications.html"}}).directive("firstLevelTab",function(){return{restrict:"E",templateUrl:"views/first_level_tab.html"}}).directive("secondLevelTab",function(){return{restrict:"E",templateUrl:"views/second_level_tab.html"}}).directive("modal",function(){return{restrict:"E",templateUrl:"views/modal.html"}}).directive("alert",function(){return{restrict:"E",templateUrl:"views/alert.html"}}).directive("errorMessage",function(){return{restrict:"E",templateUrl:"views/error_message.html"}}).directive("favorites",function(){return{restrict:"E",templateUrl:"views/favorites.html"}}).directive("sidebar",function(){return{restrict:"A",templateUrl:"views/sidebar.html"}}).directive("detailNotifications",function(){return{restrict:"A",templateUrl:"views/detail_notifications.html"}}).directive("serviceIcon",function(){return{restrict:"A",templateUrl:"views/service_icon.html"}}).directive("serviceItem",function(){return{restrict:"A",templateUrl:"views/service_item.html"}}).directive("tutorial",function(){return{restrict:"E",templateUrl:"views/tutorial.html"}}).directive("tutorialDesktop",function(){return{restrict:"A",templateUrl:"views/tutorial-desktop.html",link:function(a,b){var c=$(".royalSlider").royalSlider({autoHeight:!1,arrowsNav:!0,fadeinLoadedSlide:!1,controlNavigationSpacing:0,controlNavigation:"bullets",imageScaleMode:"none",imageAlignCenter:!1,loop:!1,loopRewind:!1,numImagesToPreload:20,keyboardNavEnabled:!0,usePreloader:!1,slidesSpacing:0,addActiveClass:!0,navigateByClick:!1,autoplay:{enabled:!1,stopAtAction:!1,pauseOnHover:!0,delay:5e3}});a.sliderInstance=c.data("royalSlider"),$(".Navigation-bullets").prepend(c.find(".rsArrow.rsArrowRight")),$(".Navigation-bullets").prepend(c.find(".rsNav")),$(".Navigation-bullets").prepend(c.find(".rsArrow.rsArrowLeft")),a.sliderInstance.ev.on("rsAfterSlideChange",function(){a.$digest()}),a.$watch(function(){return b.is(":visible")},function(){$(".royalSlider").royalSlider("updateSliderSize",!0)})}}}).directive("tutorialMobile",function(){return{restrict:"A",templateUrl:"views/tutorial-mobile.html",link:function(a,b){var c=$(".royalSlider").royalSlider({autoHeight:!1,arrowsNav:!1,fadeinLoadedSlide:!1,controlNavigationSpacing:0,controlNavigation:"none",imageScaleMode:"none",imageAlignCenter:!1,loop:!1,loopRewind:!1,numImagesToPreload:20,keyboardNavEnabled:!0,usePreloader:!1,slidesSpacing:0,addActiveClass:!0,navigateByClick:!1,autoplay:{enabled:!1,stopAtAction:!1,pauseOnHover:!0,delay:5e3}});a.sliderInstance=c.data("royalSlider"),a.sliderInstance.ev.on("rsAfterSlideChange",function(){a.$digest()}),a.$watch(function(){return b.is(":visible")},function(){$(".royalSlider").royalSlider("updateSliderSize",!0)})}}}),angular.module("lanetApp").controller("Modal",["$scope","$rootScope","$window","API",function(a,b,c,d){d.getModal().then(function(d){a.modal=b.modal=d.data,c.sessionStorage.lightbox_shown||(b.lightbox.showLightbox(),c.sessionStorage.lightbox_shown=!0)})}]).controller("Notifications",["$scope","Information","_",function(a,b,c){var d=b.all();d.then(function(b){a.information=b,c.each(a.information,function(b,d){c.isEmpty(b.contents)||(a.openedIndex=d)})}),a.openedIndex=0,a.openElement=function(b){if(b===a.openedIndex)a.openedIndex=void 0;else{var d=c.find(a.information,function(a,c){return c===b});d.contents.length>0&&(a.openedIndex=b)}}}]),angular.module("lanetApp").service("Information",["_","API","$rootScope",function(a,b,c){var d=function(b){var c=0;return a.each(b,function(a){"true"===a.is_new&&++c}),c};return this.all=function(){return b.getInformation().then(function(a){var b=[{type:"notifications",title:"Avisos",contents:a.data.notifications,count_new:d(a.data.notifications)},{type:"personal",title:"Missatges personals",contents:a.data.personal,count_new:d(a.data.personal)},{type:"news",title:"Notícies de la Xarxa",contents:a.data.news,count_new:d(a.data.news)}];return b.total_count=b[0].count_new+b[1].count_new+b[2].count_new,b},function(){c.modalFailed=!0})},this}]),angular.module("lanetApp").factory("User",["_",function(a){var b=function(b){angular.extend(this,{isRoleTeacher:function(){return a.isArray(this.role)?a.contains(this.role,"Teacher"):"Teacher"===this.role}}),angular.extend(this,b)};return b}]),angular.module("lanetApp").service("Users",["API","User",function(a,b){return this.user=function(){return a.getUserInfo().then(function(a){return new b(a.data)})},this}]),angular.module("lanetApp").controller("UserInfo",["$scope","$rootScope","Users",function(a,b,c){var d=c.user();d.then(function(c){a.user=c,b.user=c})}]),angular.module("lanetApp").controller("Search",["$scope","$rootScope","Services",function(a,b,c){a.query="",a.search=function(){c.search(b.family,a.query),c.search(b.services,a.query),c.search(b.groups,a.query)},a.clear_search=function(){a.query="",a.search()}}]),angular.module("lanetApp").factory("Service",["_",function(a){var b=function(b){angular.extend(this,{shown:!0,show:function(){this.shown=!0},hide:function(){this.shown=!1},loaded:!1,markAsLoaded:function(){this.loaded=!0},isLoaded:function(){return this.loaded},slug:function(){return this.id.toLowerCase()},isFamily:function(){return"family"===this.typology},desc:function(){return this.name},link:"",typology_class:function(){return this.typology},icon:function(){return this.slug()},image:function(){return void 0},initials:function(){return this.desc().substring(0,2)},isGroup:function(){return!1},hasNotifications:function(){return a.size(this.contents)>0},tooltip:function(){return""},getID:function(){return void 0===this.ID?this.id:this.ID}}),angular.extend(this,b)};return b}]),angular.module("lanetApp").service("Services",["_","ComponentFactory","API",function(a,b,c){var d=10,e=function(d,f){return a.map(d,function(d){return d=b.create(d),d.label=d.desc(),d.isGroup()?(d.services=e(d.services,d),"true"===d.has_notifications&&c.getNotifications(d).then(function(a){d.notifications=a.data})):"true"===d.has_contents?c.get(f,d).then(function(a){d.contents=a.data.contents,d.link_to=d.link,delete d.link}).finally(function(){d.markAsLoaded()}):d.markAsLoaded(),a.isUndefined(f)||(d.groupId=f.getID(),d.label=f.description),d})},f=function(b){return a.sortBy(b,function(a){return a.typology})},g=function(b){return a.sortBy(b,function(a){return-1===a.name.indexOf("tutoria")})},h=function(b){var c=0,e=null;return a.map(b,function(a){return a.typology_class()!==e&&(c=0),a.typology_index=c%d+1,e=a.typology_class(),a.services=h(a.services),c+=1,a})},i=function(b){return a.filter(b,function(a){return"logoff"!==a.id})},j=function(b,d){return c.endpoint(b).then(function(b){var c=b.data;return a.each(d,function(a){c=a(c)}),c})},k=function(b,c){return-1!==b.desc().toLowerCase().indexOf(c.toLowerCase())||a.some(b.services,function(a){return k(a,c)})};return{family:function(){return j("family",[e,h])},services:function(){return j("services",[e,i,f,h])},groups:function(){return j("groups",[e,g,h])},search:function(b,c){a.each(b,function(a){k(a,c)?a.show():a.hide()})}}}]),angular.module("lanetApp").controller("ServiceList",["$scope","Services","$rootScope","_",function(a,b,c,d){var e=b.services(),f=b.family(),g=b.groups();a.closeContents=!0,e.then(function(a){c.services=a,c.$emit("services",a)},function(){c.servicesFailed=!0}),f.then(function(a){c.family=a,c.$emit("services",a)},function(){c.familyFailed=!0}),g.then(function(a){c.groups=a,c.$emit("services",a)},function(){c.groupsFailed=!0}),a.thereAreElementsShown=function(a){return d.some(a,function(a){return a.shown})},a.close=function(){a.closeContents=!0,c.detail.hideDetail()},a.hideLVL2=function(){a.contents=a.parent,c.detail.hideLVL2()},a.showLVL2=function(b){var c=a.contents.services[b];a.parent=a.contents,c.contents&&a.open(c,"showLVL2")},a.show=function(b){b.link||!b.isGroup()&&!b.contents||(a.parent=b,a.open(a.parent,"showDetail"))},a.open=function(b,d){a.contents=b,a.closeContents=!1,c.detail[d]()}}]),angular.module("lanetApp").factory("ComponentFactory",["Service","Group","Family",function(a,b,c){var d=function(a){return void 0!==a.services},e=function(a){return"family"===a.typology};return{create:function(f){var g;return g=d(f)&&e(f)?new c(f):d(f)&&!e(f)?new b(f):new a(f)}}}]),angular.module("lanetApp").factory("Family",["Group",function(a){var b=function(b){angular.extend(this,new a(b)),angular.extend(this,{image:function(){return this.img},icon:function(){return this.ID.toLowerCase()},isGroup:function(){return void 0!==this.services},isUserProfile:function(){return void 0!==this.img},typology_class:function(){return this.typology},tooltip:function(){return this.isUserProfile()?"":this.ID.replace(/\./g," ")}})};return b}]),angular.module("lanetApp").factory("Group",["Service",function(a){var b=function(b){angular.extend(this,new a(b)),angular.extend(this,{loaded:!0,icon:function(){return this.slug()},slug:function(){return this.isTutorship()?"tutorship":"group"},isTutorship:function(){return-1!==this.name.toLowerCase().indexOf("tutoria")},desc:function(){return this.description},isGroup:function(){return!0},typology_class:function(){return this.isTutorship()?"tutorship":"global"},tooltip:function(){return this.ID.replace(/\./g," ")}})};return b}]),angular.module("lanetApp").controller("FavoritesList",["$scope","Favorites","$rootScope",function(a,b,c){c.favorites=b.favorites(),a.favorite=!0}]),angular.module("lanetApp").service("Favorites",["_","API","$rootScope",function(a,b,c){function d(){return b.getFavorites().then(function(a){l=a.data,f()}),k}function e(b,c){for(var d=c.group_id,f=c.service_id,g=0;g<b.length;g++){var h=b[g],i=h.getID();if(f===i)return h;if(d===i)return a.isEmpty(f)?h:e(h.services,c)}}function f(){a.isEmpty(l)||(a.each(m,function(b){a.each(l,function(c,d){var f=e(b,c);a.isUndefined(f)||(f.isFavorite=!0,k.splice(d,0,f))})}),m=[])}function g(a){var c=a.isFavorite?k.indexOf(a):k.length,d={service_id:a.isGroup()?"":a.getID(),group_id:a.isGroup()?a.getID():a.groupId||"",position:a.isFavorite?"":c,is_favorite:!a.isFavorite};a.isFavorite?k.splice(c,1):k.splice(c,0,a),a.isFavorite=!a.isFavorite,b.postFavorite(d)}function h(){return n}function i(){return k.length>0}function j(){return k.length>=n}var k=[],l=[],m=[],n=10;return c.$on("services",function(a,b){m.push(b),f()}),{favorites:d,toggleFavorite:g,maxFavorites:h,hasFavorites:i,hasMaxFavorites:j}}]),angular.module("lanetApp").service("Logger",["API","ENV",function(a,b){var c=function(c){return"development"===b?(console.debug(c),!1):a.postLog(c)};return{logNotification:function(a,b,d,e){var f={username:e.username,notification_id:b.id};return null!==a&&(f.notification_type=a),null!==d&&(f.group_id=d.ID),c(f)},logService:function(a,b,d){var e={username:d.username};return null!==b&&(e.service_id=b.id,void 0!==b.groupId&&(e.group_id=b.groupId)),null!==a&&(e.group_id=a.ID),c(e)}}}]);